{\itshape Repeatable Analysis Programming for Interpretability, Durability, and Organization}

\href{https://opensource.org/licenses/MIT}{\tt } \href{https://jkguiang.github.io/rapido/html/index.html}{\tt } \href{https://www.codefactor.io/repository/github/jkguiang/rapido/overview/master}{\tt }

R\+A\+P\+I\+DO is a C++ framework designed to make writing H\+EP analyses more ergonomic and readable. It wraps some basic functionality of \href{https://root.cern/}{\tt R\+O\+OT}. The idea is that an analysis, in general, consists of a few objects\+: a T\+Tree (to hold some skimmed N-\/\+Tuple and/or a set of histograms), a cutflow (a collection of boolean logic for filtering events), and a looper (some way to run over multiple files). R\+A\+P\+I\+DO is designed to handle all three of these tasks such that every analysis that uses it is structured in the same way. In addition, the {\itshape way} in which it is structured lends itself to the common workflow of a H\+E\+P\+Ex-\/er.

\subsection*{R\+A\+P\+I\+DO Tools}


\begin{DoxyEnumerate}
\item \hyperlink{classArbol}{Arbol}\+: T\+Tree wrapper that reduces the hassle of setting up and using T\+Trees
\item \hyperlink{classCutflow}{Cutflow}\+: Binary search tree with lambda nodes and other bells and whistles
\begin{DoxyItemize}
\item \hyperlink{classHistflow}{Histflow}\+: An extension of the \hyperlink{classCutflow}{Cutflow} object that handles histogramming at any given step of the cutflow
\end{DoxyItemize}
\item \hyperlink{classLooper}{Looper}\+: Basic looper for a T\+Chain of T\+Files that uses any selector
\end{DoxyEnumerate}

\subsection*{Set Up Instructions}


\begin{DoxyEnumerate}
\item Clone this repository
\item {\ttfamily cd} into the cloned repository and run {\ttfamily make -\/j5}
\item Write your script (e.\+g. {\ttfamily main.\+cc}) and {\ttfamily \#include} whatever you need
\item Compile and run using your favorite {\ttfamily Makefile}\+: 
\begin{DoxyCode}
1 $ g++ main.cc -o ./a -lRAPIDO -Lrapido -Irapido
2 $ export LD\_LIBRARY\_PATH=$LD\_LIBRARY\_PATH:$PWD/rapidog
3 $ \(\backslash\).a
\end{DoxyCode}

\end{DoxyEnumerate}

\subsection*{Examples}


\begin{DoxyEnumerate}
\item A simple \hyperlink{classArbol}{Arbol} example (using \href{https://github.com/cmstas/NanoTools}{\tt Nano\+C\+O\+RE} to read Nano\+A\+OD) 
\begin{DoxyCode}
\textcolor{comment}{// NanoCORE}
\textcolor{preprocessor}{#include "Nano.h"}
\textcolor{comment}{// RAPIDO}
\textcolor{preprocessor}{#include "arbol.h"}
\textcolor{preprocessor}{#include "looper.h"}

\textcolor{comment}{// Initialize Arbol}
TFile* output\_tfile = \textcolor{keyword}{new} Tfile(\textcolor{stringliteral}{"output.root"}, \textcolor{stringliteral}{"RECREATE"});
\hyperlink{classArbol}{Arbol} arbol = \hyperlink{classArbol}{Arbol}(output\_tfile);

\textcolor{comment}{// Initialize branches}
arbol.\hyperlink{classArbol_a552622885ffce15f1b1369fe44e729bb}{newBranch}<\textcolor{keywordtype}{int}>(\textcolor{stringliteral}{"event"});
arbol.\hyperlink{classArbol_a552622885ffce15f1b1369fe44e729bb}{newBranch}<\textcolor{keywordtype}{float}>(\textcolor{stringliteral}{"met"});
arbol.\hyperlink{classArbol_a552622885ffce15f1b1369fe44e729bb}{newBranch}<\textcolor{keywordtype}{float}>(\textcolor{stringliteral}{"ht"});
arbol.\hyperlink{classArbol_a552622885ffce15f1b1369fe44e729bb}{newBranch}<\textcolor{keywordtype}{int}>(\textcolor{stringliteral}{"n\_jets"});
arbol.\hyperlink{classArbol_a57b6cf7cca6cbb3b75bb0e0333dbe3c8}{newVecBranch}<\textcolor{keywordtype}{float}>(\textcolor{stringliteral}{"good\_jet\_pt"}); \textcolor{comment}{// newVecBranch<float> <-->
       newBranch<std::vector<float>>}

\textcolor{comment}{// Get file}
TChain* tchain = \textcolor{keyword}{new} TChain(\textcolor{stringliteral}{"Events"}); 
tchain->Add(\textcolor{stringliteral}{"
      root://xcache-redirector.t2.ucsd.edu:2040//store/mc/RunIIAutumn18NanoAODv7/TTJets\_DiLept\_TuneCP
      5\_13TeV-madgraphMLM-pythia8/NANOAODSIM/Nano02Apr2020\_102X\_upgrade2018\_realistic\_v21-v1/60000/69CAC742-7679-D342-BF99-BF22B6D10BA4.root"});

\textcolor{comment}{// Initialize Looper}
\hyperlink{classLooper}{Looper} looper = \hyperlink{classLooper}{Looper<Nano>}(tchain, &nt); \textcolor{comment}{// nt is a global variable from NanoCORE}

\textcolor{comment}{// Run}
looper.\hyperlink{classLooper_abfa564ca48778da1f58c8a6444ddd463}{run}(
    [&]()
    \{
        \textcolor{comment}{// --> Event-level Logic <--}
        \textcolor{comment}{// Reset tree}
        arbol.\hyperlink{classArbol_a4c2184d378ab21a9627a57098291a7c4}{resetBranches}(); \textcolor{comment}{// variables like arbol and nt are captured by reference}
        \textcolor{comment}{// Loop over jets}
        \textcolor{keywordtype}{float} ht = 0.;
        \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < nt.nJet(); i++) 
        \{
            \textcolor{keywordflow}{if} (nt.Jet\_pt()[i] > 30)
            \{
                arbol.\hyperlink{classArbol_a811156c9134ca7e0015bbe2ab95434b0}{appendToVecLeaf}<\textcolor{keywordtype}{float}>(\textcolor{stringliteral}{"good\_jet\_pt"}, Jet\_pt()[i]);
                ht += Jet\_pt()[i];
            \}
        \}
        arbol.\hyperlink{classArbol_a7a8d3bec0bf5c00635a0b00fcd63cf01}{setLeaf}<\textcolor{keywordtype}{int}>(\textcolor{stringliteral}{"event"}, event());
        arbol.\hyperlink{classArbol_a7a8d3bec0bf5c00635a0b00fcd63cf01}{setLeaf}<\textcolor{keywordtype}{float}>(\textcolor{stringliteral}{"ht"}, ht);
        arbol.\hyperlink{classArbol_a7a8d3bec0bf5c00635a0b00fcd63cf01}{setLeaf}<\textcolor{keywordtype}{float}>(\textcolor{stringliteral}{"met"}, MET\_pt());
        arbol.\hyperlink{classArbol_a7a8d3bec0bf5c00635a0b00fcd63cf01}{setLeaf}<\textcolor{keywordtype}{int}>(\textcolor{stringliteral}{"n\_jets"}, arbol.\hyperlink{classArbol_a634be85d92f5f26403407952b10a29fd}{getVecLeaf}<\textcolor{keywordtype}{float}>(\textcolor{stringliteral}{"goot\_jet\_pt"}).size());
        arbol.\hyperlink{classArbol_a1d029dd97a0451281c774b578d93bcda}{fillTTree}();
        \textcolor{keywordflow}{return}; \textcolor{comment}{// Must be void}
    \}
);

arbol.\hyperlink{classArbol_ade7d835bbe383a70006e86785ae5672c}{writeTFile}();
\end{DoxyCode}

\item Simple (no R\+O\+O\+T!) \hyperlink{classCutflow}{Cutflow} example 
\begin{DoxyCode}
\textcolor{preprocessor}{#include "cutflow.h"}
\textcolor{preprocessor}{#include <stdlib.h>}

\textcolor{keyword}{using} namepsace std;

\textcolor{keywordtype}{int} main()
\{
    \hyperlink{classCutflow}{Cutflow} dummy\_cutflow = \hyperlink{classCutflow}{Cutflow}();

    \hyperlink{classCut}{Cut}* dummy\_root = \textcolor{keyword}{new} \hyperlink{classCut}{Cut}(\textcolor{stringliteral}{"root"}, []() \{ \textcolor{keywordflow}{return} bool(rand() % 2); \});
    dummy\_cutflow.\hyperlink{classCutflow_ad27d37141c3748779a5d81fad919ecbb}{setRoot}(dummy\_root);

    \hyperlink{classCut}{Cut}* node0 = \textcolor{keyword}{new} \hyperlink{classCut}{Cut}(\textcolor{stringliteral}{"node0"}, []() \{ \textcolor{keywordflow}{return} bool(rand() % 2); \});
    dummy\_cutflow.\hyperlink{classCutflow_a8da46f1053a6b97991489ee0920c29a1}{insert}(\textcolor{stringliteral}{"root"}, node0, Left);

    \hyperlink{classCut}{Cut}* node1 = \textcolor{keyword}{new} \hyperlink{classCut}{Cut}(\textcolor{stringliteral}{"node1"}, []() \{ \textcolor{keywordflow}{return} bool(rand() % 2); \});
    dummy\_cutflow.\hyperlink{classCutflow_a8da46f1053a6b97991489ee0920c29a1}{insert}(\textcolor{stringliteral}{"root"}, node1, Right);

    \hyperlink{classCut}{Cut}* node2 = \textcolor{keyword}{new} \hyperlink{classCut}{Cut}(\textcolor{stringliteral}{"node2"}, []() \{ \textcolor{keywordflow}{return} bool(rand() % 2); \});
    dummy\_cutflow.\hyperlink{classCutflow_a8da46f1053a6b97991489ee0920c29a1}{insert}(\textcolor{stringliteral}{"node1"}, node2, Right);

    \hyperlink{classCut}{Cut}* node3 = \textcolor{keyword}{new} \hyperlink{classCut}{Cut}(\textcolor{stringliteral}{"node3"}, []() \{ \textcolor{keywordflow}{return} bool(rand() % 2); \});
    dummy\_cutflow.\hyperlink{classCutflow_a8da46f1053a6b97991489ee0920c29a1}{insert}(\textcolor{stringliteral}{"node1"}, node3, Left);

    \hyperlink{classCut}{Cut}* node4 = \textcolor{keyword}{new} \hyperlink{classCut}{Cut}(\textcolor{stringliteral}{"node4"}, []() \{ \textcolor{keywordflow}{return} bool(rand() % 2); \});
    dummy\_cutflow.\hyperlink{classCutflow_a8da46f1053a6b97991489ee0920c29a1}{insert}(\textcolor{stringliteral}{"node2"}, node4, Right);

    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 5; i++)
    \{
        \hyperlink{classCut}{Cut}* terminal\_node = dummy\_cutflow.\hyperlink{classCutflow_a563da4fc41aa5c611dd0ce37ce966f2c}{run}();
        cout << \textcolor{stringliteral}{"terminated at "} << terminal\_node->\hyperlink{classCut_accf700d2d00746b97a265d4aea3f55c2}{name} << endl;
    \}
    dummy\_cutflow.\hyperlink{classCutflow_a0cb4c8bd6d15ace1f85fe0cfb8d9d828}{print}();
\}
\end{DoxyCode}
 
\end{DoxyEnumerate}